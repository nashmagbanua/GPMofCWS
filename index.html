<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CWS GPM Tool</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f5f7fa;
      color: #333;
      padding: 20px;
      margin: 0;
    }
    .step, .log, .stopwatch-section {
      margin: 20px auto;
      max-width: 600px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      padding: 25px;
    }
    .hidden { display: none; }

    input[type="text"] {
      padding: 12px;
      width: 100%;
      font-size: 16px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 6px;
      box-shadow: inset 0 1px 2px rgba(0,0,0,0.05);
    }
    input[type="text"]:focus {
      border-color: #1976d2;
      outline: none;
    }

    button {
      background-color: #1976d2;
      color: white;
      padding: 12px 18px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      cursor: pointer;
      margin: 6px 4px;
      transition: background 0.3s ease, transform 0.2s ease;
    }
    button:hover {
      background-color: #145ea8;
      transform: scale(1.02);
    }

    .main-output {
      font-size: 32px;
      font-weight: 600;
      color: #d32f2f;
      margin-top: 20px;
    }
    .stopwatch {
      font-size: 30px;
      font-weight: 600;
      background-color: #f0f4ff;
      color: #1976d2;
      border: 2px dashed #1976d2;
      padding: 18px;
      border-radius: 10px;
      margin-bottom: 20px;
    }

    .log {
      background-color: #f1f1f1;
      padding: 20px;
      border-radius: 10px;
      max-height: 300px;
      overflow-y: auto;
      text-align: left;
      font-family: monospace;
      font-size: 13px;
    }

    .log pre {
      background-color: #fff;
      padding: 10px;
      border-left: 4px solid #1976d2;
      margin-bottom: 12px;
      border-radius: 6px;
      white-space: pre-wrap;
    }

    .dark-mode {
      background-color: #1e1e1e;
      color: #eeeeee;
    }
    .dark-mode input,
    .dark-mode button {
      background-color: #2b2b2b;
      color: #eeeeee;
      border: 1px solid #555;
    }
    .dark-mode .log {
      background-color: #2a2a2a;
      color: #f1f1f1;
    }
    .dark-mode .stopwatch {
      background-color: #222;
      border-color: #90caf9;
      color: #90caf9;
    }
    .dark-mode .main-output {
      color: #ff6666;
    }

    @media (max-width: 600px) {
      button, input[type="text"] {
        width: 100%;
        margin: 10px 0;
      }
    }
  </style>
</head>
<body>

  <div style="text-align: center;">
    <img src="D11ABC4D-7C11-4989-B6BB-BAE7AF1A8677.jpeg" 
         alt="CWS GPM Tool Banner" 
         style="max-width: 100%; height: auto; border-radius: 10px;">
  </div>

  <!-- Step 1 -->
  <div class="step" id="step1">
    <h3>Enter Operator Name</h3>
    <input type="text" id="operatorName" placeholder="Enter your name">
    <button onclick="goToStep2()">Next</button>
    <img src="banner.png" alt="Vitamilk Banner" 
         style="width: 100%; margin-top: 20px; border-radius: 6px;">
  </div>

  <!-- Step 2 -->
  <div class="step hidden" id="step2">
    <h3>Enter Deepwell Status</h3>
    <label><input type="checkbox" id="deepwell9"> Deepwell 9 - </label>
    <input type="text" id="freq9" placeholder="e.g. Standby or 60Hz"><br><br>
    <label><input type="checkbox" id="deepwell10"> Deepwell 10 - </label>
    <input type="text" id="freq10" placeholder="e.g. Standby or 48Hz"><br><br>
    <button onclick="goToStep3()">Next</button>
  </div>

  <!-- Step 3 -->
  <div class="step hidden" id="step3">
    <div class="stopwatch-section">
      <h3>Stopwatch</h3>
      <div class="stopwatch" id="stopwatchDisplay">00:00.00</div>
      <button onclick="startStopwatch()">Start</button>
      <button onclick="stopStopwatch()" disabled>Stop</button>
      <button onclick="resetStopwatch()" disabled>Reset</button>
      <div class="main-output" id="mainResult">GPM: 0.00</div>
    </div>

    <div class="log" id="flowLog">
      <strong id="logDateHeader">Flow Log as of:</strong><br><br>
      <div id="logContent"></div>
    </div>

    <button onclick="downloadCSV()">Download Log (CSV)</button>
    <button onclick="clearLog()">Clear Log</button>
    <button onclick="toggleDarkMode()">Toggle Dark Mode</button>
  </div>

<script>
let startTime, interval, logData = [];

function goToStep2() {
    if (!document.getElementById('operatorName').value) {
        alert("Please enter your name.");
        return;
    }
    document.getElementById('step1').classList.add("hidden");
    document.getElementById('step2').classList.remove("hidden");
}

function goToStep3() {
    document.getElementById('step2').classList.add("hidden");
    document.getElementById('step3').classList.remove("hidden");
    updateDateHeader();
}

function startStopwatch() {
    if (interval) return;
    startTime = Date.now();
    interval = setInterval(updateStopwatch, 100);
    document.querySelector('button[onclick="startStopwatch()"]').disabled = true;
    document.querySelector('button[onclick="stopStopwatch()"]').disabled = false;
    document.querySelector('button[onclick="resetStopwatch()"]').disabled = false;
}

function stopStopwatch() {
    clearInterval(interval);
    const elapsed = (Date.now() - startTime) / 1000;
    const gpm = (4.4 / elapsed) * 3600;
    const operator = document.getElementById('operatorName').value || "N/A";
    const deepwell9Checked = document.getElementById('deepwell9').checked;
    const deepwell10Checked = document.getElementById('deepwell10').checked;
    const freq9 = document.getElementById('freq9').value.trim();
    const freq10 = document.getElementById('freq10').value.trim();
    let status9 = deepwell9Checked ? (freq9 || "Standby/Off") : "Not Used";
    let status10 = deepwell10Checked ? (freq10 || "Standby/Off") : "Not Used";
    const dateTime = new Date();
    const datePart = dateTime.toLocaleDateString();
    const timePart = dateTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    const logEntryHTML = `[${datePart}]
Operator:            ${operator}
Deepwell 9 Status:   ${status9}
Deepwell 10 Status:  ${status10}
GPM:                 ${gpm.toFixed(2)}
TIME:                ${timePart}`;
    document.getElementById('stopwatchDisplay').innerText = elapsed.toFixed(2) + 's';
    document.getElementById('mainResult').innerText = "GPM: " + gpm.toFixed(2);
    document.getElementById('logDateHeader').innerText = 'Recent Flow Logs as of: ' + formatDateNow();
    document.getElementById('logContent').innerHTML += `<pre>${logEntryHTML}</pre>`;
    logData.push({
        time: `${datePart} ${timePart}`,
        operator: operator,
        deepwell9: status9,
        deepwell10: status10,
        seconds: elapsed.toFixed(2),
        gpm: gpm.toFixed(2)
    });
    document.querySelector('button[onclick="startStopwatch()"]').disabled = false;
    document.querySelector('button[onclick="stopStopwatch()"]').disabled = true;
}

function resetStopwatch() {
    clearInterval(interval);
    interval = null;
    document.getElementById('stopwatchDisplay').innerText = "00:00.00";
    document.getElementById('mainResult').innerText = "GPM: 0.00";
    document.querySelector('button[onclick="startStopwatch()"]').disabled = false;
    document.querySelector('button[onclick="stopStopwatch()"]').disabled = true;
    document.querySelector('button[onclick="resetStopwatch()"]').disabled = true;
}

function updateStopwatch() {
    const elapsed = (Date.now() - startTime) / 1000;
    document.getElementById('stopwatchDisplay').innerText = elapsed.toFixed(2) + 's';
}

function clearLog() {
    document.getElementById('logDateHeader').innerText = 'Flow Log as of:';
    document.getElementById('logContent').innerHTML = '';
    updateDateHeader();
    document.getElementById('flowLog').innerHTML = "<strong id='logDateHeader'>Flow Log as of: " + formatDateNow() + "</strong><br><br>";
    logData = [];
}

function formatDateNow() {
    const date = new Date();
    return date.toLocaleDateString(undefined, { year: 'numeric', month: 'long', day: 'numeric' });
}

function updateDateHeader() {
    document.getElementById('logDateHeader').innerText = "Flow Log as of: " + formatDateNow();
}

function downloadCSV() {
    let csv = "Timestamp,Operator,Deepwell 9,Deepwell 10,Seconds,GPM\n";
    logData.forEach(entry => {
        csv += `${entry.time},${entry.operator},${entry.deepwell9},${entry.deepwell10},${entry.seconds},${entry.gpm}\n`;
    });
    const blob = new Blob([csv], { type: "text/csv" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "flow_log.csv";
    a.click();
    URL.revokeObjectURL(url);
}

function toggleDarkMode() {
    document.body.classList.toggle("dark-mode");
}
</script>
</body>
</html>
